<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV PDF Highlighter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        #pdf-container {
            width: 80%;
            margin: auto;
            border: 1px solid #ccc;
        }

        canvas {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <h1>CV PDF Highlighter</h1>
    <div id="pdf-container"></div>
    <script type="module">
        import { PdfHighlighter, PdfLoader, Highlight, Popup, AreaHighlight } from "./esm/index.js";

        document.getElementById("upload-pdf").addEventListener("change", async function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async function () {
                    const pdfData = new Uint8Array(reader.result);
                    const pdfContainer = document.getElementById("pdf-container");

                    // Load the PDF using pdf.js
                    const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
                    const page = await pdf.getPage(1);
                    const scale = 1.5;
                    const viewport = page.getViewport({ scale });

                    const canvas = document.createElement("canvas");
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;
                    pdfContainer.innerHTML = ""; // Clear previous PDF
                    pdfContainer.appendChild(canvas);

                    const ctx = canvas.getContext("2d");
                    const renderContext = { canvasContext: ctx, viewport };
                    await page.render(renderContext).promise;

                    // Apply PdfHighlighter
                    const highlighter = new PdfHighlighter({
                        pdfDocument: pdf,
                        highlights: [],
                        onSelectionFinished: (position, content, hideTip) => {
                            console.log("Highlight Created", position, content);
                            hideTip();
                        },
                        highlightTransform: (highlight, index, setTip, hideTip) => {
                            return Highlight({ highlight, index, setTip, hideTip });
                        },
                    });

                    pdfContainer.appendChild(highlighter.render());
                };
                reader.readAsArrayBuffer(file);
            }
        });
    </script>

</body>

</html>